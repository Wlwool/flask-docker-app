{% extends "base.html" %}

{% block title %}Ваш пароль{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1 class="card-title">
            <span class="icon icon-bolt" aria-hidden="true">⚡</span>
            Ваш пароль готов
        </h1>
        <p class="card-subtitle">Скопируйте его и используйте там, где нужно.</p>
    </div>
    <p class="password" data-copy-target title="Нажмите, чтобы скопировать">{{ password }}</p>
    <div class="copy-feedback" role="status" aria-live="polite">Нажмите, чтобы скопировать</div>
    
    <div class="strength-indicator">
        <div class="strength-label">Сложность пароля:</div>
        <div class="strength-bar-container">
            <div class="strength-bar {% if strength < 40 %}strength-weak{% elif strength < 70 %}strength-medium{% else %}strength-strong{% endif %}" style="--strength-value: {{ strength }}%;"></div>
        </div>
        <div class="strength-text">
            {% if strength < 40 %}
                Слабый ({{ strength }}%)
            {% elif strength < 70 %}
                Средний ({{ strength }}%)
            {% else %}
                Сильный ({{ strength }}%)
            {% endif %}
        </div>
    </div>
    
    <a href="/" class="button-link">Сгенерировать новый пароль</a>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const passwordEl = document.querySelector('[data-copy-target]');
    const feedbackEl = document.querySelector('.copy-feedback');

    if (!passwordEl || !feedbackEl) {
        return;
    }

    let timeoutId;

    const showFeedback = (text, isSuccess = true) => {
        feedbackEl.textContent = text;
        feedbackEl.classList.remove('copy-feedback--error', 'copy-feedback--success');
        feedbackEl.classList.add(isSuccess ? 'copy-feedback--success' : 'copy-feedback--error', 'is-visible');

        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            feedbackEl.classList.remove('is-visible', 'copy-feedback--error', 'copy-feedback--success');
            feedbackEl.textContent = 'Нажмите, чтобы скопировать';
        }, 1500);
    };

    passwordEl.addEventListener('click', async () => {
        const value = passwordEl.textContent.trim();
        if (!value) {
            return;
        }

        try {
            await navigator.clipboard.writeText(value);
            showFeedback('Пароль скопирован!', true);
        } catch (error) {
            showFeedback('Не удалось скопировать', false);
            console.error('Clipboard error:', error);
        }
    });
});
</script>
{% endblock %}
